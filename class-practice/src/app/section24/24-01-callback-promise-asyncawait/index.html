
<!DOCTYPE html>
<html lang="ko">
<head>
    <title>콜백과 친구들</title>
    <script>
        const onClickCallback = ()=>{
            // function addEventListener(aaa, bbb){
            //     사전에 셋팅된 API주소로 요청이 끝나면?
            //     응답을 담아두고 (const res = 70)
            //     bbb(res)를 실행
            // }
            const aa = new XMLHttpRequest()
            aa.open("get", "https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1")
            aa.send()
            aa.addEventListener("load", (res)=>{
                console.log(res) //AP요청 결과      
                const num = res.target.response

                const bb = new XMLHttpRequest()
                bb.open("get", `https://jsonplaceholder.typicode.com/todos/${num}`)
                bb.send()
                bb.addEventListener("load", (res)=>{
                    const userId = res.target.response.userId

                    const cc = new XMLHttpRequest()
                    cc.open("get", `https://jsonplaceholder.typicode.com/posts?userId=${userId}`)
                    cc.send()
                    cc.addEventListener("load", (res) =>{
                        console.log(res.target.response)
                    })
                })
            })
        }
        const onClickPromise = ()=>{
            console.log("1번 째")
            fetch( "https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1".then((res)=>{
                console.log("2번 째")
                console.log(res) //AP요청 결과      
                const num = res.target.response

               return fetch( `https://jsonplaceholder.typicode.com/todos/${num}`)
            }
            ))
            .then((res)=>{
                console.log("3번 째")
                const userId = res.target.response.userId
                
                return fetch( `https://jsonplaceholder.typicode.com/posts?userId=${userId}`)
            })
            .then((res)=>{
                console.log("4번 째")
                console.log(res.target.response)
            })
            .catch((error)=>{
                //에러 통합 처리
            })
            console.log("5번 째")

        }

        //fetch, axios 등 => 대표적인 Promise룰 자원하는 기능
        //Promise를 기다리는 2가지 방법
        //1. .then()을 활용
        //2. await를 활용 즉, await는 Promise를 기다리는 것이다.
        const onClickAsyncAwait = async()=>{
            const num = await fetch("https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1")
            const userId = await fetch( `https://jsonplaceholder.typicode.com/todos/${num}`)
            const result = await fetch(`https://jsonplaceholder.typicode.com/posts?userId=${userId}`)
            
        }
    </script>
</head>
<body>
    <button onclick = "onClickCallback()">Callback 연습하기</button>
    <button onclick = "onClickPromise()">Promise 연습하기</button>
    <button onclick = "onClickAsyncAwait()">AsyncAwait 연습하기</button>
</body>
</html>